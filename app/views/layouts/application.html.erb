<!DOCTYPE html>
<html>
  <head>
    <title>Evidentai</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <%#= render "shared/navbar" %>
    <%#= render "shared/flashes" %>
    <% admin_page = controller_path.start_with?("admin/") %>
    <% auth_page = devise_controller? %>
    <% artifacts_index_page = controller_name == "artifacts" && action_name == "index" %>

    <div class="app-shell <%= "app-shell--admin" if admin_page %> <%= "app-shell--auth" if auth_page %>">
      <% unless admin_page || auth_page %>
        <aside class="sidebar">
          <div class="sidebar-header">
            <div class="brand">EvidentAI</div>

            <nav class="sidebar-nav" aria-label="Primary">
              <%= link_to "Chats",
                    chats_path,
                    class: "sidebar-nav__link #{controller_name == "chats" ? "is-active" : ""}" %>
              <%= link_to "Artifacts",
                    artifacts_path,
                    class: "sidebar-nav__link #{controller_name == "artifacts" ? "is-active" : ""}" %>
            </nav>
          </div>

          <% unless artifacts_index_page %>
            <div class="sidebar-list">
              <div class="sidebar-list__new">
                <%= button_to "New chat",
                      chats_path,
                      method: :post,
                      class: "btn btn-primary btn-block sidebar-list__new-btn" %>
              </div>
              <%= render "chats/sidebar", chats: (@chats || []) %>
            </div>
          <% else %>
            <div class="sidebar-spacer" aria-hidden="true"></div>
          <% end %>

          <div class="sidebar-footer">
            <% if current_user %>
              <%= link_to current_user.email, user_path(current_user), class: "sidebar-user-link" %>
            <% end %>

            <%= button_to "Sign out",
                  destroy_user_session_path,
                  method: :delete,
                  class: "btn btn-link" %>
          </div>
        </aside>
      <% end %>

      <main class="main <%= "main--admin" if admin_page %> <%= "main--auth" if auth_page %>">
        <%= yield %>
      </main>
    </div>
  </body>
</html>
