<%= turbo_stream_from [:admin, :ai_usage] %>

<section class="container py-4" data-controller="admin-live-status">
  <div class="admin-ai-usage__header">
    <div>
      <h1 style="margin-bottom:4px;">AI Usage & Cost</h1>
      <p class="muted" style="margin:0;">Scope: <strong>All companies, all users</strong></p>
    </div>
    <div id="admin_ai_usage_live_status"
         data-admin-live-status-target="status"
         class="admin-live-status is-live">
      <span class="admin-live-status__dot"
            aria-hidden="true"></span>
      <span class="admin-live-status__spinner"
            aria-hidden="true"
            data-admin-live-status-target="spinner"></span>
      <span class="admin-live-status__label"
            data-admin-live-status-target="label">Live</span>
    </div>
  </div>

  <div class="admin-ai-usage__content" style="margin-top:14px;">
    <div id="admin_ai_usage_report">
      <%= render partial: "admin/ai_usage/report", locals: {
        totals: @totals,
        requests: @requests,
        kind_rows: @kind_rows,
        run_rows: @run_rows,
        chat_rows: @chat_rows
      } %>
    </div>

    <aside class="card admin-live-feed">
      <div class="admin-live-feed__header">
        <h2>Live Requests</h2>
        <small class="muted">Realtime stream</small>
      </div>

      <div id="admin_ai_usage_live_feed_items" class="admin-live-feed__items">
        <% if @live_requests.empty? %>
          <div id="admin_ai_usage_live_feed_empty" class="admin-live-feed__empty muted">
            Waiting for first live requestâ€¦
          </div>
        <% else %>
          <%= render partial: "admin/ai_usage/live_request", collection: @live_requests, as: :usage %>
        <% end %>
      </div>
    </aside>
  </div>
</section>
