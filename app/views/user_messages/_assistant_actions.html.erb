<%# app/views/user_messages/_assistant_actions.html.erb %>

<% ai_message = user_message.ai_message %>
<% actions =
     ai_message&.proposed_actions
       &.where(status: "proposed")
       &.order(:id) || [] %>

<!-- STABLE TARGET: must ALWAYS exist -->
<div id="<%= dom_id(user_message, :assistant_actions) %>">
  <% if actions.any? %>
    <div class="assistant-actions" role="region" aria-label="Proposed actions">
      <div class="assistant-actions__header">
        <div class="assistant-actions__title">Proposed actions</div>
        <div class="assistant-actions__hint">
          Nothing is executed automatically.
        </div>
      </div>

      <div class="assistant-actions__grid">
        <% actions.each do |action| %>
          <%= turbo_frame_tag dom_id(action) do %>
            <article class="action-card" data-action-type="<%= action.action_type %>">
              <header class="action-card__header">
                <div class="action-card__title">
                  <span class="action-card__badge">Proposed</span>
                  <span class="action-card__type">
                    <%= action.action_type.humanize %>
                  </span>
                </div>

                <div class="action-card__meta">
                  <span class="action-card__meta-item">
                    #<%= action.id %>
                  </span>
                </div>
              </header>

              <div class="action-card__body">
                <% if action.payload.present? %>
                  <details class="action-card__details">
                    <summary>Details</summary>
                    <pre><%= JSON.pretty_generate(action.payload) %></pre>
                  </details>
                <% end %>
              </div>
            </article>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
